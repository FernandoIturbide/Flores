try{!function(){var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},r=(new e.Error).stack;r&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[r]="31ac7466-67bc-4293-a69d-3823a96a2c44",e._sentryDebugIdIdentifier="sentry-dbid-31ac7466-67bc-4293-a69d-3823a96a2c44")}()}catch(e){}"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8153],{62136:(e,r,t)=>{t.d(r,{G:()=>l});var i=t(58346),o=t(61432);let n=(0,o.createServerReference)("7fb704f5e3947e0b4190f01814c592f450c6b0eca1",o.callServer,void 0,o.findSourceMapURL,"subscribe"),a=(0,o.createServerReference)("7f8fe0b1e0e6d07abac490c81d4af53ee70938392e",o.callServer,void 0,o.findSourceMapURL,"unsubscribe");class s{async setup(){try{if(!await (0,i.TT)())return void console.warn("Firebase messaging is not supported in this browser.");this.messaging=(0,i.dG)(),await this.setupMessageListener()}catch(e){console.error("Failed to setup Firebase messaging:",e)}}async permission(){try{if(!await (0,i.TT)())return"denied";return Notification.permission}catch(e){return console.error("Failed to get notification permission:",e),"denied"}}async requestPermission(){try{if(!await (0,i.TT)())return"denied";return await Notification.requestPermission()}catch(e){return console.error("Failed to request notification permission:",e),"denied"}}async getToken(){try{if(!await (0,i.TT)()||!this.messaging)return null;return await (0,i.gf)(this.messaging,{vapidKey:"BFzCzbuMre8R3RC_h9JeqPcMY8ZXoZxnIy5grDoBalpmvZjYVoqe9ojkkLtDx45beFhy3g6C83Kbb7pvX-A8GU8"})}catch(e){return console.error("Failed to get FCM token:",e),null}}async subscribe(){try{if(!await (0,i.TT)()||!this.messaging||await this.permission()!=="granted")return!1;let e=await this.getToken();if(!e)return!1;return await n(e),!0}catch(e){return console.error("Failed to subscribe to push notifications:",e),!1}}async unsubscribe(){try{if(!await (0,i.TT)()||!this.messaging)return!1;let e=await this.getToken();if(!e)return!1;return await a(e),!0}catch(e){return console.error("Failed to unsubscribe from push notifications:",e),!1}}registerMessageHandler(e){this.messageHandlers.push(e)}unregisterMessageHandler(e){let r=this.messageHandlers.indexOf(e);r>-1&&this.messageHandlers.splice(r,1)}async setupMessageListener(){try{if(!await (0,i.TT)()||!this.messaging)return;(0,i.xD)(this.messaging,e=>{console.log("=== FOREGROUND MESSAGE RECEIVED ==="),console.log("Foreground message received:",e),this.messageHandlers.forEach(r=>{try{r(e)}catch(e){console.error("Error in message handler:",e)}})})}catch(e){console.error("Failed to setup message listener:",e)}}constructor(){this.messageHandlers=[]}}let l=new s},68153:(e,r,t)=>{let i,o;t.d(r,{AuthProvider:()=>L,A:()=>F});var n=t(91668),a=t(18394),s=t(39290),l=t(48002),c=t(89112),u=t(61432);let d=(0,u.createServerReference)("607baf8d576196ea02c59569b52a7fb7d6fbbeddcd",u.callServer,void 0,u.findSourceMapURL,"login"),g=(0,u.createServerReference)("40cc41a927e30c521955d9da046e73f61667a9c1ae",u.callServer,void 0,u.findSourceMapURL,"fetchInviteInfo"),f=(0,u.createServerReference)("405211f6c1865629877ee98b6b67fd7f287e155f82",u.callServer,void 0,u.findSourceMapURL,"linkProjects");var h=t(76126),y=t(82665),_=t(96095),p=t(28404);let m=(0,u.createServerReference)("009676ce71364ebabe564ba4a429ef7b278a25fbdc",u.callServer,void 0,u.findSourceMapURL,"logout");var w=t(62136);let v=JSON.parse('{"apiKey":"AIzaSyB9Jdqpb4h5RgHmRRJSfqTOfBT-DPV34jA","authDomain":"gglogin.youware.com","projectId":"yourware-arco","storageBucket":"yourware-arco.firebasestorage.app","messagingSenderId":"541265544701","appId":"1:541265544701:web:d52622395895582c9c4594"}');function b(){if(!o){let{auth:e}=v?(i=(0,p.Dk)().length?(0,p.Dk)()[0]:(0,p.Wp)(v),o=(0,s.xI)(i),(0,s.oM)(o,s.gz),w.G.setup(),{app:i,auth:o}):(console.error("firebaseConfig is undefined"),{app:void 0,auth:void 0});o=e}return o}async function S(){let e=b();if(!e)throw console.error("auth is undefined"),Error("auth is undefined");try{return await e.signOut(),console.log("sign out successfully"),await m()}catch(e){throw console.error("sign out error:",e),e}}var A=t(11546),k=t(46263),E=t(99726),I=t(96015);let T=(0,c.createContext)({googleLoginLoading:!1,loginWithGoogle:async()=>{},loginWithGoogleOneTap:async e=>{},sendLinkToEmail:async(e,r)=>{},signInWithEmailLink:async(e,r)=>{},isSignInWithEmailLink:e=>!1,logout:async()=>{},inviteCode:null,inviterInfo:null,inviteLoading:!1,inviteError:null,trackTriggerLogin:()=>{},trackLoginResult:()=>{}}),L=e=>{let{children:r}=e,{user:t,setUser:i}=(0,h.J)(),[o,u]=(0,c.useState)(!1),[p,m]=(0,c.useState)(null),[w,v]=(0,c.useState)(null),[L,F]=(0,c.useState)(!1),[R,O]=(0,c.useState)(null),D=b(),M=new s.HF,{identify:C,track:P,trackGoogleAds:j}=(0,y.s)(),G=(0,l.useSearchParams)();(0,c.useEffect)(()=>{var e;let r=null==(e=(0,_.jL)())?void 0:e.yw_id;C(t),r&&window.gtag&&window.gtag("config","G-6Z2G4L6M8E",{user_id:r}),a.gV({id:r,...t&&{username:t.display_name}})},[t]),(0,c.useEffect)(()=>{let e=G.get("invite_code")||(0,I.cZ)();e&&(m(e),F(!0),O(null),g(e).then(e=>{0===e.code&&e.data?(v(e.data),A.Ay.info("Fetched inviter info",{inviter_info:e.data})):(O("Failed to fetch inviter information"),A.Ay.error("Failed to fetch inviter info",Error("API error: ".concat(e.code))))}).catch(e=>{O("Error fetching inviter information"),A.Ay.error("Error fetching inviter info",e)}).finally(()=>{F(!1)}))},[G]);let N=async()=>{try{if(u(!0),!D){let e="auth is undefined";throw A.Ay.error(e),P("enter_login_flow",{login_platform:"google",stage:"failed",fail_reason:e}),Error(e)}M.setCustomParameters({prompt:"select_account"}),M.addScope("https://www.googleapis.com/auth/userinfo.profile");let e=await (0,s.df)(D,M);if(await D.signOut(),!e)throw Error("Failed to login");await J(e);let r=p||G.get("invite_code")||(0,I.cZ)()||"",t=await q(e,r,"google");(0,k.getOrigin)().includes("localhost")&&(i(t),W(t.uid)),A.Ay.info("sign in with google success")}catch(e){throw A.Ay.error("sign in with google error",e),e}finally{u(!1)}},U=async(e,r)=>{if(!D){let e="auth is undefined";throw A.Ay.error(e),P("enter_login_flow",{login_platform:"email",stage:"failed",fail_reason:e}),Error(e)}try{let t=await (0,s.hK)(D,e,r);if(await D.signOut(),!t){let e="cannot get credential";throw P("enter_login_flow",{login_platform:"email",stage:"failed",fail_reason:e}),A.Ay.error(e),Error("Failed to sign in with email link")}let o=p||G.get("invite_code")||(0,I.cZ)()||"",n=await q(t,o,"email");(0,k.getOrigin)().includes("localhost")&&(i(n),W(n.uid)),A.Ay.info("sign in with email link success",{loginUser:n})}catch(e){throw A.Ay.error("sign in with email link error",e),e}finally{window.localStorage.removeItem("emailForSignIn")}},H=async(e,r)=>{try{if(A.Ay.info("login with email"),!D)throw A.Ay.error("auth is undefined"),Error("auth is undefined");await (0,s.MN)(D,e,{url:r,handleCodeInApp:!0}),A.Ay.info("send sign in link to email success")}catch(e){throw A.Ay.error("send sign in link to email error:",e),e}},x=async e=>{try{if(!D){let e="auth is undefined";throw A.Ay.error(e),P("enter_login_flow",{login_platform:"google_one_tap",stage:"failed",fail_reason:e}),Error(e)}let r=s.HF.credential(e),t=await (0,s.eN)(D,r);if(await D.signOut(),!t)throw Error("Failed to login with Google One Tap");await J(t);let o=p||G.get("invite_code")||(0,I.cZ)()||"",n=await q(t,o,"google_one_tap");(0,k.getOrigin)().includes("localhost")&&(i(n),W(n.uid)),A.Ay.info("sign in with Google One Tap success")}catch(e){throw A.Ay.error("sign in with Google One Tap error",e),e}},Z=async()=>{try{console.log("sign out"),await S(),i(null)}catch(e){throw console.error("sign out error:",e),e}},J=async e=>{let r=e.user;A.Ay.info("sync google user profile",{user:r});let t=r.providerData.find(e=>"google.com"===e.providerId);if(A.Ay.info("sync google providerInfo",{providerInfo:t}),t){let{displayName:e,photoURL:i}=t;if(!r.displayName&&e&&await (0,s.r7)(r,{displayName:e}),!r.photoURL&&i){let e=i.replace(/=s\d+-c$/,"=s400-c");await (0,s.r7)(r,{photoURL:e})}}},q=async(e,r,t)=>{var i;let o=e.user;A.Ay.info("sync user to server",{user:o});let n=await o.getIdToken(),a=await d(n,r);if(200!==a.code||!(null==(i=a.data)?void 0:i.userInfo))throw P("enter_login_flow",{login_platform:t,stage:"failed",fail_reason:a.message}),Error("sync user to server failed");return a.data.userInfo},W=async e=>{if(A.Ay.info("handle anonymous projects"),e){let r=JSON.parse(localStorage.getItem("Anonymous_Projects")||"[]");if(r.length>0)try{f({uid:e,project_ids:r}),localStorage.removeItem("Anonymous_Projects"),A.Ay.info("Projects linked successfully in background")}catch(e){A.Ay.error("Background project linking failed:",e)}}};return(0,n.jsx)(T.Provider,{value:{googleLoginLoading:o,loginWithGoogle:N,loginWithGoogleOneTap:x,sendLinkToEmail:H,isSignInWithEmailLink:e=>D?(0,s.Pj)(D,e):(A.Ay.error("auth is undefined"),!1),signInWithEmailLink:U,logout:Z,inviteCode:p,inviterInfo:w,inviteLoading:L,inviteError:R,trackTriggerLogin:(e,r)=>{var t;P("login_continue_button_click",{login_platform:e,enter_from:r,location:(0,E.em)(),inviter_user_id:(null==w||null==(t=w.user)?void 0:t.uid)||"",...(0,I.oi)()})},trackLoginResult:(e,r,t,i)=>{var o;P("login_status",{login_platform:e,result:r,fail_reason:i,enter_from:t,location:(0,E.em)(),inviter_user_id:(null==w||null==(o=w.user)?void 0:o.uid)||"",...(0,I.oi)()}),"success"===r&&j("conversion",{send_to:"AW-17743331840/HLDcCOb7yccbEICE14xC"})}},children:r})},F=()=>(0,c.useContext)(T)},96015:(e,r,t)=>{t.d(r,{cQ:()=>n,cZ:()=>a,oi:()=>s});let i="visit_source";function o(){try{let e=localStorage.getItem(i);return e?JSON.parse(e):{}}catch(e){return console.error("Failed to parse visit source data:",e),{}}}function n(){let e=function(e){try{let r=new URL(e).searchParams,t=r.get("invite_code");if(t)return{type:"invite_code",value:t,url:e,timestamp:Date.now()};let i=r.get("utm_source");if(i)return{type:"utm_source",value:i,url:e,timestamp:Date.now()};return null}catch(e){return console.error("Failed to extract source from URL:",e),null}}(window.location.href);if(!e)return;let r={...o()};r.first_source||(r.first_source=e),r.latest_source=e,"invite_code"===e.type?r.latest_invite_code=e:"utm_source"===e.type&&(r.latest_utm_source=e);try{localStorage.setItem(i,JSON.stringify(r))}catch(e){console.error("Failed to save visit source data:",e)}}function a(){var e,r;let t=o(),i=Date.now();return(null==(e=t.latest_source)?void 0:e.type)==="utm_source"?null:(null==(r=t.latest_source)?void 0:r.type)==="invite_code"&&t.latest_source.timestamp&&i-t.latest_source.timestamp<=2592e6?t.latest_source.value:null}function s(){var e,r,t,i,n,a;let s=o();return{first_impression_source_type:(null==(e=s.first_source)?void 0:e.type)||"",first_impression_source_value:(null==(r=s.first_source)?void 0:r.value)||"",first_impression_source_url:(null==(t=s.first_source)?void 0:t.url)||"",last_impression_source_type:(null==(i=s.latest_source)?void 0:i.type)||"",last_impression_source_value:(null==(n=s.latest_source)?void 0:n.value)||"",last_impression_source_url:(null==(a=s.latest_source)?void 0:a.url)||""}}}}]);