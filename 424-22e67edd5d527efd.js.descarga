try{!function(){var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="bb9af0c4-b8b1-4064-82cb-b38ace3b4b36",e._sentryDebugIdIdentifier="sentry-dbid-bb9af0c4-b8b1-4064-82cb-b38ace3b4b36")}()}catch(e){}(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[424],{4483:(e,t,s)=>{"use strict";s.d(t,{C:()=>i,N:()=>o});var a=s(91668),r=s(97913),l=s(67230),n=s(17390);let c=(e,t,s)=>{l.A.getInstance().track("sub_paywall_popup",{action:e,plan_type:t,click_from:s})},o=e=>{let{click_from:t,onConfirm:s,...o}=null!=e?e:{};c("show","pro",t);let i={title:"Pro plan required",description:"This feature is a benefit of the Pro plan and requires an upgrade to use.",cancelText:"Cancel",confirmText:(0,a.jsxs)("button",{className:"flex h-9 cursor-pointer items-center justify-center gap-1 rounded-full bg-[#FFD15D] pl-3 pr-4 text-[#A55500] hover:bg-[#FFD15D]/85",children:[(0,a.jsx)(n.a,{className:"size-4"}),(0,a.jsx)("span",{children:"Upgrade"})]}),onCancel:()=>{},onConfirm:()=>{c("upgrade","pro",t),l.A.getInstance().track("sub_upgrade_click",{click_from:t}),null==s||s()},className:"w-[380px]"};(0,r.S)({...i,...o})},i=e=>{let{click_from:t,onConfirm:s,...o}=null!=e?e:{};c("show","ultra",t);let i={title:"Ultra plan required",description:"This feature is a benefit of the Ultra plan and requires an upgrade to use.",cancelText:"Cancel",confirmText:(0,a.jsxs)("button",{className:"flex h-9 cursor-pointer items-center justify-center gap-1 rounded-full bg-[#FFD15D] pl-3 pr-4 text-[#A55500] hover:bg-[#FFD15D]/85",children:[(0,a.jsx)(n.a,{className:"size-4"}),(0,a.jsx)("span",{children:"Upgrade"})]}),onCancel:()=>{},onConfirm:()=>{c("upgrade","ultra",t),l.A.getInstance().track("sub_upgrade_click",{click_from:t}),null==s||s()},className:"w-[380px]"};(0,r.S)({...i,...o})}},20292:(e,t,s)=>{"use strict";s.d(t,{A:()=>w});var a=s(91668),r=s(97637),l=s(89112);let n=s.p+"static/media/backend_fill_icon.c8ef648d52e8533b.svg";var c=s(42449),o=s(95280),i=s(11996),d=s(41284),u=s(97913),p=s(11546),h=s(21864),m=s(82642);let x={DATA_SECTION:"data_section",USER_LIMIT_SECTION:"user_limit_section"},b=(0,l.forwardRef)((e,t)=>{let{isExpanded:s,onToggle:n}=e,c=(0,l.useRef)(null),o=(0,l.useRef)(null);return(0,l.useImperativeHandle)(t,()=>({scrollToDataSection:e=>{let t=null;if(e===x.DATA_SECTION&&(t=c.current),e===x.USER_LIMIT_SECTION&&(t=o.current),t){t.scrollIntoView({behavior:"smooth",block:"start"});try{let e=window.getSelection(),s=document.createRange();s.selectNodeContents(t),null==e||e.removeAllRanges(),null==e||e.addRange(s),setTimeout(()=>{null==e||e.removeAllRanges()},2e3)}catch(e){console.error(e)}}}})),(0,a.jsx)("div",{className:"rounded-[12px] border border-black/6",children:(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex items-start justify-between p-4 hover:cursor-pointer",onClick:n,children:[(0,a.jsx)("h3",{className:"typo-body-strong",children:"What's YouWare Backend?"}),(0,a.jsx)("button",{className:"flex h-4 items-center justify-center","aria-label":s?"Expand":"Collapse",children:(0,a.jsx)(r.O9s,{className:(0,m.cn)("h-4 w-4 transition-transform duration-200",s?"rotate-180":"")})})]}),s&&(0,a.jsxs)("div",{className:"space-y-4 px-4 pb-4",children:[(0,a.jsx)("p",{className:"typo-small",children:"Make your websites come alive! Instead of just showing static pages, your visitors can now interact, vote, comment, and see real-time updates. It's like turning a poster into a living, breathing app."}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("h4",{className:"typo-small-strong",children:"What it gives you:"}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsx)("div",{className:"typo-small",children:(0,a.jsxs)("ul",{className:"list-none space-y-0",children:[(0,a.jsxs)("li",{className:"relative pl-4",children:[(0,a.jsx)("span",{className:"absolute top-0 left-0",children:"•"}),(0,a.jsx)("span",{className:"font-bold",children:"Database - "}),(0,a.jsx)("span",{children:"Remember votes, comments, scores - nothing gets lost when people refresh the page"})]}),(0,a.jsxs)("li",{className:"relative pl-8",children:[(0,a.jsx)("span",{className:"absolute top-0 left-4",children:"•"}),(0,a.jsx)("span",{children:"Examples: Store poll votes, save game scores, keep user comments"})]})]})}),(0,a.jsx)("div",{className:"typo-small",children:(0,a.jsxs)("ul",{className:"list-none space-y-0",children:[(0,a.jsxs)("li",{className:"relative pl-4",children:[(0,a.jsx)("span",{className:"absolute top-0 left-0",children:"•"}),(0,a.jsx)("span",{className:"font-bold",children:"Edge Functions - "}),(0,a.jsx)("span",{children:"Your site can automatically count votes, update rankings, send notifications"})]}),(0,a.jsxs)("li",{className:"relative pl-8",children:[(0,a.jsx)("span",{className:"absolute top-0 left-4",children:"•"}),(0,a.jsx)("span",{children:"Examples: Auto-calculate poll results, update leaderboards, trigger alerts"})]})]})}),(0,a.jsx)("div",{className:"typo-small",children:(0,a.jsxs)("ul",{className:"list-none space-y-0",children:[(0,a.jsxs)("li",{className:"relative pl-4",children:[(0,a.jsx)("span",{className:"absolute top-0 left-0",children:"•"}),(0,a.jsx)("span",{className:"font-bold",children:"Built-in Auth - "}),(0,a.jsx)("span",{children:'Show actual YouWare user names and photos instead of "Anonymous User"'})]}),(0,a.jsxs)("li",{className:"relative pl-8",children:[(0,a.jsx)("span",{className:"absolute top-0 left-4",children:"•"}),(0,a.jsx)("span",{children:"Examples: Display real profiles in comments, show player names on scoreboards, personalize experiences"})]})]})})]})]}),(0,a.jsxs)("div",{ref:o,className:"space-y-2",children:[(0,a.jsx)("h4",{className:"typo-small-strong",children:"Important: Free vs Subscribed User Limits"}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsx)("div",{className:"typo-small",children:(0,a.jsx)("ul",{className:"list-none space-y-0",children:(0,a.jsxs)("li",{className:"relative pl-4",children:[(0,a.jsx)("span",{className:"absolute top-0 left-0",children:"•"}),(0,a.jsx)("span",{className:"font-bold",children:"Free Users: "}),(0,a.jsx)("span",{children:"You can create up to 1 Backend projects. Each project stays online for 7 days, then automatically expires."})]})})}),(0,a.jsx)("div",{className:"typo-small",children:(0,a.jsx)("ul",{className:"list-none space-y-0",children:(0,a.jsxs)("li",{className:"relative pl-4",children:[(0,a.jsx)("span",{className:"absolute top-0 left-0",children:"•"}),(0,a.jsx)("span",{className:"font-bold",children:"Subscribed Users: "}),(0,a.jsx)("span",{children:"Your Backend projects remain active based on your subscription cycle. Projects expire only when your subscription ends or is cancelled."})]})})})]})]}),(0,a.jsxs)("div",{ref:c,className:"space-y-2",children:[(0,a.jsx)("h4",{className:"typo-small-strong",children:"Important: Don't lose your data"}),(0,a.jsx)("p",{className:"typo-small",children:"If you cancel your subscription or pause your backend projects, your website stays online and all code remains safe. However, backend functions stop working immediately and all data will be permanently deleted after 7 days. Make sure to download your data within this period if you need it!"})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("h4",{className:"typo-small-strong",children:"Important: Privacy Protection"}),(0,a.jsx)("p",{className:"typo-small",children:"Feel free to build with confidence using YouWare Backend! To protect your data privacy and security, we ensure that projects using YouWare Backend cannot be remixed by other users. Only the frontend code can be remixed - your backend functions and database remain completely private and secure. We've got your data security covered!"})]})]})]})})});b.displayName="BackendInfo";let f={pause:"Project paused. Data will be deleted in 7 days.",run:"Project is now running."},g={pause:"Failed to pause project. Please try again.",run:"Failed to run project. Please try again.",run_out_of_quota:"Cannot run project - backend usage exceeded. Upgrade or pause other projects.",run_project_deleted:"Cannot run project - the project has been deleted"};s(33767);let y={pause:"deactivate",run:"activate"},v=e=>{let{color:t}=e;return(0,a.jsx)("div",{className:(0,m.cn)("h-1 w-1 shrink-0 rounded-full",t)})},j=e=>{let{action:t,loading:s=!1,onClick:l}=e;return(0,a.jsx)("button",{onClick:l,disabled:s,className:"typo-small-strong flex h-[22px] w-[60px] items-center justify-center rounded-full bg-black/6 px-3 py-1 text-black/65 transition-colors hover:cursor-pointer hover:bg-black/10 disabled:opacity-50",children:s?(0,a.jsx)(r.xNY,{className:"h-3 w-3 animate-spin"}):(0,a.jsx)("span",{children:(()=>{switch(t){case"pause":return"Pause";case"run":return"Run";case"export":return"Export";default:return t}})()})})},_=e=>{let{project:t,showDeadline:s=!1,showExpireLine:r=!1,isVip:l=!1,actionStates:n,onActionClick:c,onProjectClick:i,onExportClick:d}=e,u=t.status===o.e.ACTIVATED?"bg-[#6E9D4C]":"bg-[#D42727]",p=t.status===o.e.ACTIVATED?["pause"]:["run"],h=(t.status,["export"]),m=(e=>{if(e.status===o.e.DEACTIVATED&&e.destroy_time){let t=new Date(e.destroy_time);return"".concat(t.getMonth()+1,"/").concat(t.getDate())}return"-"})(t),x=((e,t)=>{if(e.status===o.e.ACTIVATED){if(t)return"Unlimited";if(e.expected_deactivate_time){let t=new Date(e.expected_deactivate_time);return"".concat(t.getMonth()+1,"/").concat(t.getDate())}}return"-"})(t,l),b=n[t.project.uuid]||{};return(0,a.jsxs)("div",{className:"backend-table-gap flex h-9 items-center border-b border-black/3 py-2.5 pr-2 pl-3 last:border-b-0",children:[(0,a.jsxs)("div",{className:"flex min-w-0 flex-1 items-center gap-1.5",children:[(0,a.jsx)(v,{color:u}),(0,a.jsx)("div",{className:"typo-small cursor-pointer truncate",onClick:()=>i(t.project.uuid),children:t.project.name})]}),s&&(0,a.jsx)("div",{className:"backend-table-cell typo-small shrink-0",children:m}),r&&(0,a.jsx)("div",{className:"backend-table-cell typo-small shrink-0",children:x}),(0,a.jsx)("div",{className:"backend-table-cell typo-small shrink-0",children:t.status===o.e.ACTIVATED?"Running":"Paused"}),(0,a.jsx)("div",{className:"backend-table-cell flex shrink-0 gap-1",children:p.map((e,s)=>(0,a.jsx)(j,{action:e,loading:b[e],onClick:()=>c(t.project.uuid,e)},s))}),(0,a.jsx)("div",{className:"flex w-[60px] shrink-0",children:h.map((e,s)=>(0,a.jsx)(j,{action:e,loading:b[e],onClick:()=>d(t.project.uuid)},s))})]})},k=e=>{let{showDeadline:t=!1,showExpireLine:s=!1,statusLogo:r}=e;return(0,a.jsxs)("div",{className:"backend-table-gap thin-scrollbar flex h-9 items-center border-b border-black/6 bg-black/3 pr-2 pl-3",children:[(0,a.jsx)("div",{className:"typo-small-strong min-w-0 flex-1 truncate text-black/45",children:"Project name"}),t&&(0,a.jsx)("div",{className:"backend-table-cell typo-small-strong shrink-0 text-black/45",children:"Deadline"}),s&&(0,a.jsx)("div",{className:"backend-table-cell typo-small-strong shrink-0 text-black/45",children:"Expired"}),(0,a.jsx)("div",{className:"backend-table-cell typo-small-strong shrink-0 text-black/45",children:(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)("span",{children:"Status"}),r]})}),(0,a.jsx)("div",{className:"backend-table-cell typo-small-strong shrink-0 text-black/45",children:"Service"}),(0,a.jsx)("div",{className:"typo-small-strong w-[60px] shrink-0 text-black/45",children:"Data"})]})},N=e=>{let{status:t}=e;return(0,a.jsxs)("div",{className:"backend-table-gap flex h-9 items-center border-b border-black/3 pr-2 pl-3 last:border-b-0",children:[(0,a.jsxs)("div",{className:"flex min-w-0 flex-1 items-center gap-1.5",children:[(0,a.jsx)("div",{className:"h-1 w-1 shrink-0 rounded-full border border-black/30"}),(0,a.jsx)("div",{className:"typo-small truncate text-black/30",children:"No project available"})]}),(0,a.jsx)("div",{className:"backend-table-cell typo-body shrink-0 text-black/30",children:"-"}),(0,a.jsx)("div",{className:"backend-table-cell typo-body shrink-0 text-black/30",children:"-"}),(0,a.jsx)("div",{className:"backend-table-cell typo-body shrink-0 text-black/30",children:"-"}),(0,a.jsx)("div",{className:"typo-body w-[60px] shrink-0 text-black/30",children:"-"})]})},A=()=>(0,a.jsxs)("div",{className:"flex h-9 items-center justify-center gap-1 border-b border-black/3 px-3 py-2.5 text-black/45 last:border-b-0",children:[(0,a.jsx)(r.xNY,{className:"h-3 w-3 animate-spin"}),(0,a.jsx)("div",{className:"typo-small",children:"Loading..."})]}),C=e=>{let{onRetry:t}=e;return(0,a.jsx)("div",{className:"flex h-9 items-center justify-center gap-6 border-b border-black/3 px-3 py-2.5 last:border-b-0",children:(0,a.jsxs)("button",{onClick:t,className:"typo-small flex items-center gap-1 text-black/45 hover:cursor-pointer",children:[(0,a.jsx)("span",{children:"Network error, please retry"}),(0,a.jsx)(r.Ll9,{className:"ml-1 h-3 w-3"})]})})};function w(e){let{onClose:t,enterFrom:s}=e,{usage:m,fetchUsage:v,fetchActiveProjects:j,fetchPausedProjects:w,executeAction:E,downloadDatabase:S}=(0,o.O)(),[T,I]=(0,l.useState)([]),[D,P]=(0,l.useState)([]),[R,U]=(0,l.useState)(""),[L,O]=(0,l.useState)(""),[F,B]=(0,l.useState)(!1),[M,Y]=(0,l.useState)(!1),[V,G]=(0,l.useState)(!1),[K,H]=(0,l.useState)(!1),[W,q]=(0,l.useState)(!0),[Q,X]=(0,l.useState)(!0),[z,J]=(0,l.useState)(!1),[Z,$]=(0,l.useState)(!1),[ee,et]=(0,l.useState)({}),[es,ea]=(0,l.useState)(!1),er=(0,l.useRef)(null),{subscriptionInfo:el}=(0,i.R)(),en=null==el?void 0:el.is_vip,ec=(0,l.useRef)(null),eo=(0,l.useRef)(null),{openSubscription:ei}=(0,d.$)();(0,l.useEffect)(()=>{ed()},[el]),(0,l.useEffect)(()=>{0===m.active&&ea(!0)},[]);let ed=()=>{v(),eu(),ep()},eu=async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];try{e||q(!0);let t=await j();t?(I(t.records),U(t.page_info.next_cursor||""),B(t.page_info.has_more),J(!1)):J(!0)}catch(e){J(!0)}finally{e||q(!1)}},ep=async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];try{e||X(!0);let t=await w();t?(P(t.records),O(t.page_info.next_cursor||""),Y(t.page_info.has_more),$(!1)):$(!0)}catch(e){$(!0)}finally{e||X(!1)}},eh=(0,l.useCallback)(async()=>{if(!F||V||!R)return;G(!0);let e=await j(R);e&&(I(t=>[...t,...e.records]),U(e.page_info.next_cursor||""),B(e.page_info.has_more)),G(!1)},[F,V,R,j]),em=(0,l.useCallback)(async()=>{if(!M||K||!L)return;H(!0);let e=await w(L);e&&(P(t=>[...t,...e.records]),O(e.page_info.next_cursor||""),Y(e.page_info.has_more)),H(!1)},[M,K,L,w]),ex=(0,l.useCallback)((e,t)=>{let s=e.current;if(!s)return;let{scrollTop:a,scrollHeight:r,clientHeight:l}=s;r-a-l<100&&t()},[]),eb=(0,l.useCallback)(async e=>{et(t=>({...t,[e]:{...t[e],export:!0}}));try{await S(e,"pop_up_backend")}finally{et(t=>({...t,[e]:{...t[e],export:!1}}))}},[S]),ef=(0,l.useCallback)(async(e,t)=>{et(s=>({...s,[e]:{...s[e],[t]:!0}}));try{let s=await E(e,y[t]);if((null==s?void 0:s.code)===0)(0,h.P)({message:f[t],type:"success"}),"pause"===t?(I(t=>t.filter(t=>t.project.uuid!==e)),ep(!0)):"run"===t&&(P(t=>t.filter(t=>t.project.uuid!==e)),eu(!0));else{let e=g[t];(null==s?void 0:s.code)===40305&&"run"===t&&(e=g.run_out_of_quota),(null==s?void 0:s.code)===40306&&"run"===t&&(e=g.run_project_deleted),(0,h.P)({message:e,type:"error"})}}catch(e){p.Ay.error("Failed to execute ".concat(t,":"),e),(0,h.P)({message:g[t],type:"error"})}finally{et(s=>({...s,[e]:{...s[e],[t]:!1}}))}},[E,eu,ep]),eg=(0,l.useCallback)(async(e,t)=>{"pause"===t?(0,u.S)({title:"Pause Backend Service",description:"Backend will stop immediately. You have 7 days to restart or data will be permanently deleted.",cancelText:"Cancel",confirmText:"Pause",onCancel:()=>{},onConfirm:()=>{ef(e,t)}}):ef(e,t)},[ef]),ey=(0,l.useCallback)(e=>{window.open("/editor/".concat(e,"?enter_from=backend_modal"),"_blank")},[]),ev=(0,l.useCallback)(async()=>{q(!0),J(!1);try{let e=await j();e?(I(e.records),U(e.page_info.next_cursor||""),B(e.page_info.has_more)):J(!0)}catch(e){J(!0)}finally{q(!1)}},[j]),ej=(0,l.useCallback)(async()=>{X(!0),$(!1);try{let e=await w();e?(P(e.records),O(e.page_info.next_cursor||""),Y(e.page_info.has_more)):$(!0)}catch(e){$(!0)}finally{X(!1)}},[w]);(0,l.useEffect)(()=>{let e=ec.current,t=eo.current,s=()=>ex(ec,eh),a=()=>ex(eo,em);return e&&e.addEventListener("scroll",s),t&&t.addEventListener("scroll",a),()=>{e&&e.removeEventListener("scroll",s),t&&t.removeEventListener("scroll",a)}},[ex,eh,em]);let e_=(0,l.useCallback)(()=>{s===c.Y.SUBSCRIPTION_PAGE||ei({query:{location:c.Y.POP_UP_BACKEND}}),null==t||t()},[s,t,ei]),ek=(0,l.useCallback)(()=>{es||ea(!0),setTimeout(()=>{var e;null==(e=er.current)||e.scrollToDataSection(x.USER_LIMIT_SECTION)},200)},[es]),eN=(0,l.useCallback)(()=>{es||ea(!0),setTimeout(()=>{var e;null==(e=er.current)||e.scrollToDataSection(x.DATA_SECTION)},200)},[es]);return(0,a.jsxs)("div",{className:"mt-2 mb-5 flex flex-col gap-3",children:[(0,a.jsxs)("div",{className:"flex h-12 items-center gap-2 rounded-[12px] border border-black/6 bg-black/3 py-2 pr-2 pl-3",children:[(0,a.jsx)("img",{src:n,alt:"pro",className:"h-5 w-5"}),(0,a.jsx)("div",{className:"typo-body-strong flex-1 text-black/95",children:"".concat((null==m?void 0:m.active)||"0","/").concat((null==m?void 0:m.total)||"0"," Backend Project")}),(0,a.jsx)("button",{onClick:e_,className:"bg-brand hover:bg-brand/90 typo-small-strong flex h-8 items-center justify-center rounded-full px-3.5 py-2 text-white transition-colors hover:cursor-pointer",children:en?"View plans":"Upgrade"})]}),(0,a.jsxs)("div",{className:"flex flex-col gap-5",children:[(0,a.jsxs)("div",{className:"overflow-hidden rounded-[12px] border border-black/6",children:[(0,a.jsx)(k,{showExpireLine:!0,statusLogo:(0,a.jsx)("button",{onClick:ek,className:"flex h-3.5 w-3.5 items-center justify-center transition-colors hover:cursor-pointer hover:opacity-70",children:(0,a.jsx)(r.Kt4,{className:"h-3.5 w-3.5 text-black/35"})})}),(0,a.jsx)("div",{ref:ec,className:"thin-scrollbar max-h-[200px] overflow-y-auto",children:W?(0,a.jsx)(A,{}):z?(0,a.jsx)(C,{onRetry:ev}):0===T.length?(0,a.jsx)(N,{status:o.e.ACTIVATED}):(0,a.jsxs)(a.Fragment,{children:[T.map(e=>(0,a.jsx)(_,{project:e,showExpireLine:!0,isVip:en,actionStates:ee,onActionClick:eg,onProjectClick:ey,onExportClick:eb},e.project.uuid)),V&&F&&(0,a.jsx)("div",{className:"flex items-center justify-center py-4",children:(0,a.jsx)("div",{className:"typo-small text-black/45",children:"Loading more..."})})]})})]}),(0,a.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,a.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)("div",{className:"typo-body-strong text-black/95",children:"Paused projects"}),(0,a.jsx)("button",{onClick:eN,className:"flex h-3.5 w-3.5 items-center justify-center transition-colors hover:cursor-pointer hover:opacity-70",children:(0,a.jsx)(r.Kt4,{className:"h-3.5 w-3.5 text-black/65"})})]}),(0,a.jsx)("div",{className:"typo-small text-black/45",children:"Backend services will be permanently deleted after deadline (including data)."})]}),(0,a.jsxs)("div",{className:"overflow-hidden rounded-[12px] border border-black/6",children:[(0,a.jsx)(k,{showDeadline:!0}),(0,a.jsx)("div",{ref:eo,className:"thin-scrollbar max-h-[200px] overflow-y-auto",children:Q?(0,a.jsx)(A,{}):Z?(0,a.jsx)(C,{onRetry:ej}):0===D.length?(0,a.jsx)(N,{status:o.e.DEACTIVATED}):(0,a.jsxs)(a.Fragment,{children:[D.map(e=>(0,a.jsx)(_,{project:e,showDeadline:!0,isVip:en,actionStates:ee,onActionClick:eg,onProjectClick:ey,onExportClick:eb},e.project.uuid)),K&&M&&(0,a.jsx)("div",{className:"flex items-center justify-center py-4",children:(0,a.jsx)("div",{className:"typo-small text-black/45",children:"Loading more..."})})]})})]})]})]}),(0,a.jsx)(b,{ref:er,isExpanded:es,onToggle:()=>ea(!es)})]})}},31333:(e,t,s)=>{"use strict";s.d(t,{CreditsProvider:()=>O,I:()=>F});var a=s(91668),r=s(48002),l=s(89112),n=s(61432);let c=(0,n.createServerReference)("4067ff88931ffb0a3c085234d9f730d837465e74dd",n.callServer,void 0,n.findSourceMapURL,"fetchPaymentStatus"),o=(0,n.createServerReference)("00c977ad5f558852b268f7e6dd9c6e651313f28e30",n.callServer,void 0,n.findSourceMapURL,"fetchPurchasePrices"),i=(0,n.createServerReference)("607fc4650f4c928af462e1dacffcc69a597e2ede7b",n.callServer,void 0,n.findSourceMapURL,"createPaymentCheckout");var d=s(97637),u=s(71617);let p=(0,n.createServerReference)("40218b760c4817b3d9da3935e1048d30bbef97177a",n.callServer,void 0,n.findSourceMapURL,"fetchCreditUsage");var h=s(49849),m=s(29224),x=s(11996),b=s(41284),f=s(82665),g=s(46263),y=s(35108),v=s(12082),j=s(82642);function _(e){let{enterFrom:t,onClose:s,onBuyCredits:n}=e,c=(0,r.usePathname)(),{subscriptionInfo:o}=(0,x.R)(),[i,_]=(0,l.useState)([]),[k,N]=(0,l.useState)(!1),[A,C]=(0,l.useState)(""),[w,E]=(0,l.useState)(!1),S=(0,l.useRef)(null),{track:T}=(0,f.s)(),{openSubscription:I}=(0,b.$)();(0,l.useEffect)(()=>{T("credits_usage_pop_up_show",{enter_from:t||"",credits_num:(null==o?void 0:o.total_credits)||0})},[t,o,T]),(0,l.useEffect)(()=>{D()},[]);let D=(0,l.useCallback)(async()=>{if(!k){N(!0);try{let s=await p({limit:20,cursor:A});if(0===s.code&&s.data){var e,t;let a=s.data.records||[];_(e=>[...e,...a]),C((null==(e=s.data.page_info)?void 0:e.next_cursor)||""),E((null==(t=s.data.page_info)?void 0:t.has_more)||!1)}}catch(e){console.error("Failed to load credit usage:",e)}finally{N(!1)}}},[k,A]),P=(0,l.useCallback)(()=>{i.length>0&&w&&!k&&A&&D()},[i.length,w,k,A]),R=(0,l.useCallback)(()=>{let e=S.current;if(!e)return;let{scrollTop:t,scrollHeight:s,clientHeight:a}=e;s-t-a<100&&P()},[P]);return(0,l.useEffect)(()=>{let e=S.current;if(e)return e.addEventListener("scroll",R),()=>e.removeEventListener("scroll",R)},[R]),(0,a.jsx)("div",{className:"fixed inset-0 z-60 flex items-center justify-center bg-black/12",onClick:s,children:(0,a.jsxs)("div",{className:"relative flex h-[600px] w-full max-w-[640px] flex-col rounded-[30px] border border-black/3 bg-white p-5 pb-0 shadow-[0px_16px_32px_-1px_rgba(0,0,0,0.1)]",onClick:e=>e.stopPropagation(),children:[(0,a.jsxs)("div",{className:"flex flex-shrink-0 items-start justify-center gap-2",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("h2",{className:"typo-h2",children:"Credits usage"}),(0,a.jsx)("div",{className:"typo-small text-black/45",children:"Micro-spends (<1 credit) are not shown."})]}),(0,a.jsx)("button",{onClick:s,className:"flex h-6 w-6 cursor-pointer items-center justify-center rounded-full p-1 transition-colors hover:bg-black/3",children:(0,a.jsx)(d.Qks,{className:"h-4 w-4"})})]}),(0,a.jsxs)("div",{className:"my-3 flex h-12 w-full flex-shrink-0 items-center gap-2 rounded-[12px] border border-black/6 bg-black/3 pr-2 pl-3",children:[(0,a.jsx)(d.IId,{className:"text-brand h-5 w-5"}),(0,a.jsxs)("div",{className:"typo-body-strong flex-1",children:[((null==o?void 0:o.total_credits)||0).toLocaleString()," Credits"]}),(0,v.k6)(o)?(0,a.jsx)("button",{className:"typo-body flex h-8 cursor-pointer items-center justify-center rounded-[10px] bg-[#55644A] px-2.5 font-medium text-white transition-colors hover:bg-[#55644A]/90",onClick:n,children:"Credits Top-Up"}):!c.startsWith("/subscription")&&(0,a.jsx)("button",{className:"bg-brand hover:bg-brand/90 typo-small-strong flex h-8 cursor-pointer items-center justify-center rounded-full px-3.5 text-white transition-colors",onClick:()=>{T("sub_upgrade_click",{click_from:"credits_usage"}),null==s||s(),I({query:{location:"pop_up"}})},children:"Get More"})]}),(0,a.jsxs)("div",{className:"mb-[38px] flex w-full flex-1 flex-col overflow-hidden rounded-[12px] border border-black/6",children:[(0,a.jsxs)("div",{className:"thin-scrollbar typo-small flex items-center gap-5 overflow-y-auto border-b border-black/6 bg-[#F7F7F7] px-3 py-2.5 text-black/45",children:[(0,a.jsx)("div",{className:"w-25",children:"Date"}),(0,a.jsx)("div",{className:"flex-1",children:"Details"}),(0,a.jsx)("div",{className:"w-25",children:"Credits change"})]}),(0,a.jsx)("div",{ref:S,className:"thin-scrollbar flex-1 overflow-y-auto",children:0===i.length?(0,a.jsx)("div",{className:"typo-small flex h-96 items-center justify-center text-black/65",children:k?(0,a.jsx)(h.A,{animationPath:m.S0,className:"h-20 w-20"}):"No credit usage records found"}):(0,a.jsxs)(a.Fragment,{children:[i.map((e,t)=>{var s;return(0,a.jsxs)("div",{className:"typo-small flex items-center gap-5 border-b border-black/3 px-3 py-2.5",children:[(0,a.jsx)("div",{className:"w-25",children:(0,y.Y)(e.date_timestamp)}),(0,a.jsx)("div",{className:(0,j.cn)("flex-1 truncate",e.project_id||e.project_url?"cursor-pointer hover:underline":""),onClick:()=>{e.project_url?window.open((0,g.getProjectOrigin)()+e.project_url,"_blank"):e.project_id&&window.open("/editor/".concat(e.project_id),"_blank")},children:e.description}),(0,a.jsxs)("div",{className:"typo-small flex w-25 items-center gap-1",children:[(0,a.jsxs)("span",{children:["consumption"===e.transaction_type?"-":"+",e.credit_cost]}),(null==(s=e.extra_data)?void 0:s.help_type)==="engagement"&&(0,a.jsxs)(u.m_,{children:[(0,a.jsx)(u.k$,{asChild:!0,children:(0,a.jsx)(d.Kt4,{className:"h-3 w-3 flex-shrink-0 cursor-pointer text-black/45 hover:text-black/65"})}),(0,a.jsx)(u.ZI,{side:"top",sideOffset:4,className:"z-60",children:(0,a.jsx)("div",{className:"w-72 p-1.5",children:"Daily project engagement reward is earned through views, reactions, saves, remixes, and comments on your projects — designed to reward creativity and genuine engagement. Rewards are calculated based on the previous UTC day. Suspicious or inauthentic activity won't count."})})]})]})]},t)}),k&&i.length>0&&(0,a.jsx)("div",{className:"flex items-center justify-center py-4",children:(0,a.jsx)("div",{className:"typo-small text-black/45",children:"Loading more..."})})]})})]}),(0,a.jsx)("div",{className:"absolute bottom-3 left-1/2 -translate-x-1/2",children:(0,a.jsx)("button",{className:"typo-small cursor-pointer text-black/65 transition-colors hover:text-black/95 hover:underline",onClick:()=>{window.open("/legal/credits","_blank")},children:"How credits work"})})]})})}let k={src:"/_next/static/media/credits_sku_ advanced_bg.41468258.png",height:480,width:480,blurDataURL:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAMAAADz0U65AAAAD1BMVEUFBQUSEQ8bGhg0My8pJyK1iCIQAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAJklEQVR4nG3JMQoAAAgDsWv1/28WqaNbIIDkrgJ4sAoU7PXBPsgDDTEAVoumahIAAAAASUVORK5CYII=",blurWidth:8,blurHeight:8},N={src:"/_next/static/media/credits_sku_default_bg.2eb8143f.png",height:480,width:480,blurDataURL:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAMAAADz0U65AAAABlBMVEXz8u/49vTJaNJ9AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAGklEQVR4nGNgYGAEAwYkBhhAGeh8EI0pxggAA9kAFbrT1WgAAAAASUVORK5CYII=",blurWidth:8,blurHeight:8},A={src:"/_next/static/media/credits_sku_normal_bg.ae5cf31a.png",height:480,width:480,blurDataURL:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAMAAADz0U65AAAAElBMVEX935v946b95rP97sr9677/9Nqcdn+WAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAKklEQVR4nC3MsREAMAgDsceG/VfOmdCpEpTa9kApClYDYbc/pEV04JDiARFoAGYk+rd4AAAAAElFTkSuQmCC",blurWidth:8,blurHeight:8};var C=s(82243);function w(e){let{products:t,loading:s,error:r,purchasingProductId:n,onClose:c,onPurchase:o,onRetry:i,onShowCreditsModal:u}=e,{subscriptionInfo:p}=(0,x.R)(),{track:b}=(0,f.s)(),g=(0,C.I)();(0,l.useEffect)(()=>{b("credits_topup_popup",{action:"show"})},[]);let y=(0,l.useCallback)(e=>{let t=[{bgImage:N,textColor:"text-[#55644a]",iconColor:"text-[#55644a]",buttonBg:"bg-brand",buttonText:"text-white",buttonHover:"hover:bg-brand/90"},{bgImage:A,textColor:"text-[#a55500]",iconColor:"text-[#a55500]",buttonBg:"bg-[#a55500]",buttonText:"text-white",buttonHover:"hover:bg-[#a55500]/90"},{bgImage:k,textColor:"text-[#ffd15d]",iconColor:"text-[#ffd15d]",buttonBg:"bg-[#ffd15d]",buttonText:"text-[#a55500]",buttonHover:"hover:bg-[#ffd15d]/90"}];return t[e]||t[0]},[]),v=(0,l.useCallback)(()=>{c(),u("credits_purchase_modal")},[c,u]);return(0,a.jsx)("div",{className:"z-60 fixed inset-0 flex items-center justify-center bg-black/20 p-4",children:(0,a.jsxs)("div",{className:(0,j.cn)("border-black/3 relative flex w-full flex-col rounded-[32px] border bg-white shadow-[0px_16px_32px_-1px_rgba(0,0,0,0.1)]",g?"p-4":"max-w-[826px] p-5"),children:[(0,a.jsxs)("div",{className:"flex shrink-0 items-start gap-2 p-1",children:[(0,a.jsx)("h2",{className:"typo-h2 flex-1 font-semibold",children:"Credits Top-Up"}),(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)("span",{className:"typo-body",children:"My Credits:"}),(0,a.jsxs)("div",{className:"bg-brand/12 flex cursor-pointer items-center gap-0.5 rounded-full py-0.5 pl-1 pr-2",onClick:v,children:[(0,a.jsx)(d.IId,{className:"text-brand h-4 w-4"}),(0,a.jsx)("span",{className:"typo-body text-brand",children:((null==p?void 0:p.total_credits)||0).toLocaleString()})]})]}),(0,a.jsx)("button",{onClick:c,className:"hover:bg-black/3 flex h-6 w-6 cursor-pointer items-center justify-center rounded-lg p-1 transition-colors",children:(0,a.jsx)(d.Qks,{className:"h-4 w-4"})})]}),(0,a.jsx)("div",{className:(0,j.cn)("overflow-y-auto",g?"my-3 max-h-[440px]":"my-7 max-h-[480px]"),children:s&&0===t.length?(0,a.jsx)("div",{className:"flex h-60 items-center justify-center",children:(0,a.jsx)(h.A,{animationPath:m.S0,className:"h-20 w-20"})}):r?(0,a.jsxs)("div",{className:"flex h-60 flex-col items-center justify-center gap-4",children:[(0,a.jsx)("p",{className:"typo-body text-black/65",children:"Network error"}),(0,a.jsx)("button",{onClick:i,className:"bg-brand hover:bg-brand/90 typo-small-strong rounded-full px-4 py-2 text-white transition-colors",children:"Retry"})]}):(0,a.jsx)("div",{className:(0,j.cn)(g?"flex flex-col gap-3":"grid grid-cols-3 gap-3"),children:t.slice(0,3).map((e,t)=>{let s=y(t),r=n===e.price_id,l=null!==n&&!r,c=e.credits+(e.reward_credits||0),i=e.credits,u=e.reward_credits||0;return(0,a.jsxs)("div",{className:(0,j.cn)("border-black/3 relative h-60 overflow-hidden rounded-3xl border",l&&"opacity-50"),children:[(0,a.jsx)("div",{className:"absolute inset-0 bg-cover bg-center bg-no-repeat",style:{backgroundImage:"url('".concat(s.bgImage.src,"')")}}),(0,a.jsxs)("div",{className:"relative flex h-full flex-col justify-between p-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)(d.IId,{className:(0,j.cn)("h-8 w-8",s.iconColor)}),(0,a.jsx)("span",{className:(0,j.cn)("typo-h1 font-semibold",s.textColor),children:c.toLocaleString()})]}),u>0&&(0,a.jsxs)("div",{className:"typo-body-strong top-15 absolute left-5",children:[(0,a.jsxs)("span",{className:(0,j.cn)("font-normal",s.textColor),children:[i.toLocaleString()," + "]}),(0,a.jsxs)("span",{className:s.textColor,children:[u.toLocaleString()," Bonus"]})]}),(0,a.jsxs)("div",{className:"flex items-end justify-between",children:[(0,a.jsxs)("span",{className:(0,j.cn)("typo-h2 font-semibold",s.textColor),children:[e.currency_symbol,(e.display_amount/100).toFixed(2)]}),(0,a.jsx)("button",{onClick:()=>!l&&o(e.price_id),disabled:l,className:(0,j.cn)("typo-small-strong flex h-7 items-center justify-center rounded-full px-3 transition-colors",s.buttonBg,s.buttonText,s.buttonHover,l&&"cursor-not-allowed",r&&"min-w-[80px]"),children:r?(0,a.jsx)("div",{className:"h-4 w-4 animate-spin rounded-full border-2 border-white border-t-transparent"}):(0,a.jsx)("span",{children:"Purchase"})})]})]})]},e.price_id)})})}),(0,a.jsx)("p",{className:"typo-small shrink-0 text-black/45",children:"Credits are valid for two years and can’t be transferred, withdrawn, or refunded."})]})})}var E=s(75021),S=s(78246),T=s(12474),I=s(11546),D=s(21864);let P=(0,I.tZ)("credits"),R={UNEXPECTED:{type:"info",message:"Your payment is being verified. Please check again later."},SUCCESS:{type:"success",message:"Purchase completed! Your credits have been added."},FAILURE:{type:"error",message:"Payment failed. Please try again."}};async function U(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;for(let a=1;a<=t;a++){try{var s;let r=await c(e);if(0===r.code&&(null==(s=r.data)?void 0:s.status)){let{status:e}=r.data;if(["succeeded","failed","refunded","canceled"].includes(e)||a===t)return{status:e,requestId:r.request_id};P.warn("Payment status is ".concat(e,", retrying in 500ms (attempt ").concat(a,"/").concat(t,")"))}else if(P.error("Failed to fetch payment status",r),a===t)break}catch(e){if(P.error("Error polling payment status (attempt ".concat(a,"/").concat(t,")"),e),a===t)break}await new Promise(e=>setTimeout(e,500))}return null}let L=(0,l.createContext)({showCreditsModal:()=>{},showCreditsPurchaseModal:()=>{}}),O=e=>{let{children:t}=e,s=(0,r.useSearchParams)(),[n,c]=(0,l.useState)(!1),[d,u]=(0,l.useState)(!1),[p,h]=(0,l.useState)([]),[m,x]=(0,l.useState)(!1),[b,g]=(0,l.useState)(!1),[y,v]=(0,l.useState)(null),j=(0,l.useRef)(void 0),k=(0,l.useRef)(null),N=(0,l.useRef)(!1),{track:A}=(0,f.s)(),C=(0,l.useCallback)(async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(k.current)return k.current;let t=(async()=>{try{e||x(!0),g(!1);let t=await o();if(0===t.code&&t.data)h(t.data.purchase_prices),P.trace("Credit products fetched successfully",{count:t.data.purchase_prices.length}),0===(t.data.purchase_prices||[]).length&&(0,I.tZ)("server-actions").warn("[credits] "+E.G.PRICE_LIST_EMPTY,{scene:E.s.CREDITS,type:E.G.PRICE_LIST_EMPTY,category:"server_action",request_id:t.request_id});else throw(0,I.tZ)("server-actions").error("[credits] "+E.G.PRICE_FETCH_FAILED,{scene:E.s.CREDITS,type:E.G.PRICE_FETCH_FAILED,category:"server_action",code:t.code,message:t.message,request_id:t.request_id}),Error(t.message||"Failed to fetch credit products")}catch(t){P.error("Error fetching credit products",t),g(!0),e||(0,D.P)({type:"error",message:"Failed to load credit products"})}finally{x(!1),k.current=null}})();return k.current=t,t},[]),O=(0,l.useCallback)(e=>{j.current=e,c(!0)},[]),F=(0,l.useCallback)(()=>{c(!1)},[]),B=(0,l.useCallback)(()=>{u(!0),0===p.length?C(!1):C(!0)},[p.length,C]),M=(0,l.useCallback)(()=>{u(!1)},[]),Y=(0,l.useCallback)(()=>{F(),B()},[F,B]),V=(0,l.useCallback)(async e=>{v(e),A("credits_topup_popup",{action:"purchase"});try{var t;let s=window.location.href,a=new URL(s);a.searchParams.set("purchase_scene",S.dc.CREDITS_PURCHASE_MODAL);let r=await i(e,a.toString());if(0===r.code&&(null==(t=r.data)?void 0:t.checkout_url))window.location.href=r.data.checkout_url;else throw Error(r.message||"Failed to create checkout session")}catch(e){(0,D.P)({type:"error",message:"Oops, something went wrong. Please try again"}),P.error("Error creating checkout session",e),v(null)}},[]),G=(0,l.useCallback)(()=>{C(!1)},[C]);return(0,l.useEffect)(()=>{if(N.current)return;let e=s.get("payment_status"),t=s.get("order_id"),a=s.get("purchase_scene")||"";if(S.YC.includes(a)){if(N.current=!0,B(),setTimeout(()=>{(e=>{let t=new URL(window.location.href);e.forEach(e=>{t.searchParams.delete(e)}),window.history.replaceState({},"",t.pathname+t.search)})(["payment_status","order_id","purchase_scene"])},0),"success"!==e)return void P.info("[credits] "+E.G.CHECKOUT_URL_STATUS_UNSUCCESS,{scene:E.s.CREDITS,type:E.G.CHECKOUT_URL_STATUS_UNSUCCESS,status:e,order_id:t,purchase_scene:a});(async e=>{try{if(e&&"__ORDER_ID__"!==e){P.info("Processing payment success callback",{orderId:e,purchaseScene:a});let t=await U(e);!function(e,t){if(!e){P.error("[credits] "+E.G.STATUS_POLL_FAILED,{scene:E.s.CREDITS,type:E.G.STATUS_POLL_FAILED,order_id:null==t?void 0:t.orderId}),(0,D.P)(R.UNEXPECTED);return}let{status:s,requestId:a}=e;switch(s){case"succeeded":(0,D.P)(R.SUCCESS);break;case"failed":case"canceled":P.error("[credits] "+E.G.CHECKOUT_CALLBACK_FAILED,{scene:E.s.CREDITS,type:E.G.CHECKOUT_CALLBACK_FAILED,order_id:null==t?void 0:t.orderId,request_id:a,status:s}),(0,D.P)(R.FAILURE);break;case"processing":case"init":P.warn("[credits] "+E.G.STATUS_UNKNOWN_OR_EMPTY,{scene:E.s.CREDITS,type:E.G.STATUS_UNKNOWN_OR_EMPTY,order_id:null==t?void 0:t.orderId,request_id:a,status:s}),(0,D.P)(R.UNEXPECTED);break;default:P.warn("Unknown payment status",{status:s}),P.warn("[credits] "+E.G.STATUS_UNKNOWN_OR_EMPTY,{scene:E.s.CREDITS,type:E.G.STATUS_UNKNOWN_OR_EMPTY,order_id:null==t?void 0:t.orderId,request_id:a,status:s})}}(t,{orderId:e})}else P.error("[credits] "+E.G.CALLBACK_INVALID_ORDER_ID,{scene:E.s.CREDITS,type:E.G.CALLBACK_INVALID_ORDER_ID,purchase_scene:a,order_id:e,url:window.location.href})}catch(e){P.error("Error handling payment callback",e),(0,D.P)(R.UNEXPECTED)}T.X.sendMessage("CreditsUpdated")})(t||"")}},[s,B]),(0,a.jsxs)(L.Provider,{value:{showCreditsModal:O,showCreditsPurchaseModal:B},children:[t,n&&(0,a.jsx)(_,{enterFrom:j.current,onClose:F,onBuyCredits:Y}),d&&(0,a.jsx)(w,{products:p,loading:m,error:b,purchasingProductId:y,onClose:M,onShowCreditsModal:O,onPurchase:V,onRetry:G})]})},F=()=>(0,l.useContext)(L)},33767:()=>{},35108:(e,t,s)=>{"use strict";s.d(t,{W:()=>i,Y:()=>d});var a=s(68281),r=s.n(a),l=s(87851),n=s.n(l),c=s(9042),o=s.n(c);function i(e){let t=r()(e);return t.isToday()?t.format("HH:mm"):t.format("M/D")}function d(e,t){return e?new Date(1e3*e).toLocaleDateString("en-US",t||{month:"short",day:"numeric"}):""}r().extend(n()),r().extend(o())},42449:(e,t,s)=>{"use strict";s.d(t,{Y:()=>a});let a={CHAT_CALL_TO_ACTION:"chat_call_to_action",SUBSCRIPTION_PAGE:"subscription_page",HEADER_USER_MENU:"header_user_menu",EDITOR_MENU:"editor_menu",POP_UP_BACKEND:"pop_up_backend"}},49849:(e,t,s)=>{"use strict";s.d(t,{A:()=>c});var a,r,l=s(91668),n=s(89112);null==(r=globalThis||window)||null==(a=r.requestIdleCallback)||a.call(r,()=>s.e(6531).then(s.t.bind(s,41052,23)));let c=e=>{let{animationPath:t,animationData:a,className:r="",style:c,renderer:o="svg",loop:i=!0,autoplay:d=!0,errorComponent:u,loadingComponent:p,onError:h,onLoad:m}=e,x=(0,n.useRef)(null),[b,f]=(0,n.useState)(null),[g,y]=(0,n.useState)(!0);return((0,n.useEffect)(()=>{let e=null,r=!0;return(async()=>{try{f(null),y(!0);let l=(await s.e(6531).then(s.t.bind(s,41052,23))).default;if(!r||!x.current)return;(e=l.loadAnimation({container:x.current,renderer:o,loop:i,autoplay:d,path:t,...a&&{animationData:a}})).addEventListener("DOMLoaded",()=>{r&&(y(!1),null==m||m())}),e.addEventListener("error",()=>{r&&(f("Lottie loading error"),y(!1),null==h||h("Lottie loading error"))})}catch(e){r&&(f("Lottie loading error"),y(!1),null==h||h("Lottie loading error"))}})(),()=>{r=!1,e&&e.destroy()}},[t,i,d,o]),b&&u)?u:g&&p?p:(0,l.jsx)("div",{ref:x,className:r,style:c})}},51876:(e,t,s)=>{"use strict";s.d(t,{i:()=>a});let a=e=>{var t;return!!((null==(t=e.backend_info)?void 0:t.status)||e.backend_data_exists)}},75021:(e,t,s)=>{"use strict";s.d(t,{G:()=>r,s:()=>a});let a={SUBSCRIPTION:"subscription",CREDITS:"credits"},r={BOUNDARY_TRIGGERED:"BoundaryTriggered",CALLBACK_INVALID_ORDER_ID:"CallbackInvalidOrderId",CHECKOUT_URL_STATUS_UNSUCCESS:"CheckoutUrlStatusUnsuccess",STATUS_POLL_FAILED:"StatusPollFailed",STATUS_UNKNOWN_OR_EMPTY:"StatusUnknownOrEmpty",CHECKOUT_CALLBACK_FAILED:"CheckoutCallbackFailed",CHECKOUT_REQUEST_ERROR:"CheckoutRequestError",PRICE_FETCH_FAILED:"PriceFetchFailed",PRICE_LIST_EMPTY:"PriceListEmpty"}},95280:(e,t,s)=>{"use strict";s.d(t,{e:()=>y,BackendProvider:()=>_,O:()=>k});var a=s(91668),r=s(89112),l=s(4499),n=s(4483),c=s(97637),o=s(82243),i=s(82642),d=s(20292);let u=e=>{let{onClose:t,enterFrom:s=""}=e,r=(0,o.I)(!1,720);return(0,a.jsx)("div",{className:"fixed inset-0 z-61 flex cursor-auto items-center justify-center bg-black/12 p-4",onClick:t,children:(0,a.jsxs)("div",{className:(0,i.cn)("relative flex flex-col overflow-hidden rounded-[30px] bg-white shadow-[0px_16px_32px_-1px_rgba(0,0,0,0.1)]",r?"h-[600px] w-full max-w-[400px]":"h-[600px] w-full max-w-[640px]"),onClick:e=>e.stopPropagation(),children:[(0,a.jsxs)("div",{className:"flex flex-shrink-0 items-start justify-between gap-2 px-5 pt-5 pb-3",children:[(0,a.jsx)("div",{className:"flex-1",children:(0,a.jsx)("h2",{className:"typo-h2",children:"Backend usage"})}),(0,a.jsx)("button",{onClick:t,className:"flex h-6 w-6 cursor-pointer items-center justify-center rounded-full p-1 transition-colors hover:bg-black/3",children:(0,a.jsx)(c.Qks,{className:"h-4 w-4 text-black/95"})})]}),(0,a.jsx)("div",{className:"scrollbar-hide flex-1 overflow-y-auto px-5 pb-5",children:(0,a.jsx)(d.A,{onClose:t,enterFrom:s})})]})})};var p=s(41284),h=s(82665),m=s(11546),x=s(21864),b=s(51876),f=s(11996),g=s(76126),y=function(e){return e.ACTIVATED="activated",e.DEACTIVATED="deactivated",e.DELETED="deleted",e}({});let v={active:0,total:0},j=(0,r.createContext)({usage:{...v},isModalVisible:!1,fetchUsage:async()=>{},fetchActiveProjects:async()=>null,fetchPausedProjects:async()=>null,executeAction:async()=>null,downloadDatabase:async()=>{},showModal:e=>{},hideModal:()=>{}}),_=e=>{let{children:t}=e,[s,c]=(0,r.useState)(v),{subscriptionInfo:o,isVipUser:i}=(0,f.R)(),{track:d}=(0,h.s)(),{user:y}=(0,g.J)(),_=(0,r.useRef)(""),{openSubscription:k}=(0,p.$)(),[N,A]=(0,r.useState)(!1),C=(0,r.useRef)(null),w=(0,r.useRef)({}),E=(0,r.useCallback)(async()=>{try{var e,t;let s=await (0,l.VQ)("backend/getBackendQuota",{method:"GET"}),a={active:(null==(e=s.data)?void 0:e.used_count)||0,total:(null==(t=s.data)?void 0:t.total_quota)||0};c(a)}catch(e){m.Ay.error("Error refreshing backend usage:",e)}finally{C.current=null}},[c]),S=(0,r.useCallback)(async e=>{try{var t,s,a,r,n,c;let o=await (0,l.VQ)("backend/listBackendProjects",{method:"POST",params:{cursor:e,limit:15,status:["activated"]}});return{records:null!=(c=null==(t=o.data)?void 0:t.data)?c:[],page_info:{next_cursor:null==(a=o.data)||null==(s=a.page_info)?void 0:s.next_cursor,has_more:(null==(n=o.data)||null==(r=n.page_info)?void 0:r.has_more)||!1}}}catch(e){throw m.Ay.error("Error fetching active projects:",e),e}},[]),T=(0,r.useCallback)(async e=>{try{var t,s,a,r,n,c;let o=await (0,l.VQ)("backend/listBackendProjects",{method:"POST",params:{cursor:e,limit:15,status:["deactivated"]}});return{records:null!=(c=null==(t=o.data)?void 0:t.data)?c:[],page_info:{next_cursor:null==(a=o.data)||null==(s=a.page_info)?void 0:s.next_cursor,has_more:(null==(n=o.data)||null==(r=n.page_info)?void 0:r.has_more)||!1}}}catch(e){throw m.Ay.error("Error fetching paused projects:",e),e}},[]),I=(0,r.useCallback)(async(e,t)=>{try{let s=await (0,l.VQ)("backend/projectAction",{method:"POST",params:{project_uuid:e,action:t}});return s&&0===s.code&&E(),s}catch(e){throw m.Ay.error("Failed to execute project action:",e),e}},[E]),D=(0,r.useCallback)(e=>{d("sub_backend_usage",{enter_from:e}),_.current="string"==typeof e&&e?e:"",A(!0)},[d]),P=(0,r.useCallback)(()=>{A(!1)},[]),R=(0,r.useCallback)(async(e,t,s,a)=>{if(!w.current[e]&&(!a||(0,b.i)(a)&&a.allow_download))if(i){d("sub_download_click",{file_type:"data",type:t,project_id:e}),w.current[e]=!0;try{var r;let t=await (0,l.VQ)("backend/exportDatabase",{method:"POST",params:{project_uuid:e,tables:s}});if(null==(r=t.data)?void 0:r.signed_url){let e=document.createElement("a");e.href=t.data.signed_url,e.style.display="none",document.body.appendChild(e),e.click(),document.body.removeChild(e)}else(0,x.P)({message:"Failed to download database",type:"error"})}catch(e){(0,x.P)({message:"Failed to download database",type:"error"}),m.Ay.error("Failed to download database:",e)}finally{w.current[e]=!1}}else(0,n.N)({click_from:"export_database",onConfirm:()=>{k({query:{location:"app_page"}}),P()}})},[o,d,k]);return(0,r.useEffect)(()=>{(null==y?void 0:y.uid)&&E()},[null==y?void 0:y.uid,null==o?void 0:o.price_key,E]),(0,a.jsxs)(j.Provider,{value:{usage:s,isModalVisible:N,fetchUsage:E,fetchActiveProjects:S,fetchPausedProjects:T,executeAction:I,downloadDatabase:R,showModal:D,hideModal:P},children:[t,N&&(0,a.jsx)(u,{onClose:P,enterFrom:_.current})]})},k=()=>(0,r.useContext)(j)}}]);