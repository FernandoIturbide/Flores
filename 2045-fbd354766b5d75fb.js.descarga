try{!function(){var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="62441b8f-47bc-42a8-9839-711e534861c2",e._sentryDebugIdIdentifier="sentry-dbid-62441b8f-47bc-42a8-9839-711e534861c2")}()}catch(e){}"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2045],{40909:(e,t,a)=>{a.d(t,{EmojiProvider:()=>K,k:()=>Q});var i=a(91668),n=a(89112);let o=a.p+"static/media/100_lottie.cef0db4f66be86b9.json",r=a.p+"static/media/100.b877a1b6bc26bb95.svg",c=a.p+"static/media/clap_lottie.6c508c145e2685f7.json",s=a.p+"static/media/clap.3619a1d128a337dd.svg",l=a.p+"static/media/flying-saucer_lottie.3cc027a35e935626.json",d=a.p+"static/media/flying-saucer.e5f98c955c5dd502.svg",u=a.p+"static/media/heart-eyes_lottie.9953ff76e9ce01b6.json",p=a.p+"static/media/heart-eyes.a43655a5c4e1ad4c.svg",h=a.p+"static/media/money-with-wings_lottie.321d0dfc8e8be847.json",f=a.p+"static/media/money-with-wings.5da470d696e966ca.svg",y=a.p+"static/media/rofl_lottie.78fdf80f68740281.json",m=a.p+"static/media/rofl.20da8d0c720f9776.svg",g=a.p+"static/media/salute_lottie.9de44125e5831e5d.json",b=a.p+"static/media/salute.6df41d26ff9a07f7.svg";var v=a(76126),w=a(54623),_=a(10578),j=a(11546),T=a(61432);let S=(0,T.createServerReference)("7085ebadff0c789d5f6c5a9e756316f0ec9bc461fc",T.callServer,void 0,T.findSourceMapURL,"postInteract");var I=a(61924);class O{addOperation(e,t,a,i){let n="".concat(e.project_id,"-").concat(t,"-").concat(Date.now());this.queue=this.queue.filter(a=>!(a.project_id===e.project_id&&a.interaction_type===t&&!this.isOperationInProgress(a.id)));let o=e.interaction||{count:[],status:[]};o=this.calculateUpdatedInteraction(e,t,a),i&&(this.callbacks.get(e.project_id)||new Set).forEach(t=>{t(e.project_id,o)});let r={id:n,project_id:e.project_id,interaction_type:t,action:a,timestamp:Date.now()};return this.queue.push(r),this.scheduleBatch(),n}registerCallback(e,t){var a;return this.callbacks.has(e)||this.callbacks.set(e,new Set),null==(a=this.callbacks.get(e))||a.add(t),()=>{let a=this.callbacks.get(e);a&&(a.delete(t),0===a.size&&this.callbacks.delete(e))}}isOperationInProgress(e){return this.processingOperations.has(e)}getOperationKey(e){return"".concat(e.project_id,"-").concat(e.interaction_type)}scheduleBatch(){this.batchTimer&&clearTimeout(this.batchTimer),this.batchTimer=setTimeout(()=>{this.processQueue()},this.batchDelay)}async processQueue(){if(0===this.queue.length)return;this.batchTimer=null;let e=new Map;for(let a of this.queue){var t;let i=this.getOperationKey(a);e.has(i)||e.set(i,[]),null==(t=e.get(i))||t.push(a)}let a=[];for(let[t,i]of e.entries()){if(this.processingOperations.has(t))continue;let e=i[0];a.push(this.processOperation(e,t))}a.length>0&&(await Promise.all(a),this.queue.length>0&&this.scheduleBatch())}async processOperation(e,t){this.processingOperations.add(t),this.processingOperations.add(e.id);try{await S(e.project_id,e.action,e.interaction_type),this.queue=this.queue.filter(t=>t.id!==e.id)}catch(t){console.error("Failed to process interaction operation:",t),this.queue=this.queue.filter(t=>t.id!==e.id)}finally{this.processingOperations.delete(t),this.processingOperations.delete(e.id)}}calculateUpdatedInteraction(e,t,a){var i,n;let o=[...(null==(i=e.interaction)?void 0:i.count)||[]],r=[...(null==(n=e.interaction)?void 0:n.status)||[]],c=r.findIndex(e=>e.interaction_type===t);c>=0?r[c]={...r[c],status:a===I.f.Add}:a===I.f.Add&&r.push({interaction_type:t,status:!0});let s=o.findIndex(e=>e.interaction_type===t);if(s>=0){let e=a===I.f.Add?1:-1;o[s]={...o[s],count:Math.max(0,o[s].count+e)}}else a===I.f.Add&&o.push({interaction_type:t,count:1});return{count:o,status:r}}constructor(){this.queue=[],this.processingOperations=new Set,this.batchTimer=null,this.batchDelay=500,this.callbacks=new Map}}let F="yourware-emoji-list",x="yourware-emoji-lottie-cache",k=[],C=!1,E=[],L={},D=new Map,q=!1,A=e=>{E.forEach(t=>t(e)),E=[]},P=()=>{try{let e=localStorage.getItem(x);e&&(L=JSON.parse(atob(e)))}catch(e){j.vF.error("Failed to load Lottie cache",e),L={},localStorage.removeItem(x)}},M=async e=>{if(!e||L[e]&&L[e].expireTime>Date.now()&&L[e].data)return;if(D.has(e))return D.get(e);let t=(async()=>{try{j.vF.trace("Start loading Lottie: ".concat(e));let t=await fetch(e+"?from="+encodeURIComponent(window.location.hostname)),a=await t.json();L[e]={data:a,expireTime:Date.now()+864e5};try{localStorage.setItem(x,btoa(JSON.stringify(L)))}catch(e){j.vF.error("Failed to save Lottie cache",e)}j.vF.trace("Lottie loaded successfully: ".concat(e))}catch(t){j.vF.error("Failed to preload Lottie: ".concat(e),t)}finally{D.delete(e)}})();return D.set(e,t),t},R=e=>{q||(q=!0,P(),setTimeout(async()=>{try{j.vF.trace("Start preloading all Lottie animations");let t=e.filter(e=>e.lottie).map(e=>e.lottie);await Promise.all([...new Set(t)].map(e=>M(e))),j.vF.trace("All Lottie animations preloaded successfully")}catch(e){j.vF.error("Failed to preload Lottie animations",e)}finally{q=!1}},2e3))},J=e=>e?L[e]&&L[e].expireTime>Date.now()&&L[e].data?L[e].data:(D.has(e)||setTimeout(()=>{M(e).catch(console.error)},0),null):null,N=()=>{try{let e=localStorage.getItem(F);if(!e)return{data:[],isExpired:!0};let t=JSON.parse(atob(e)),a=t.expireTime<Date.now();return{data:t.data,isExpired:a}}catch(e){return j.vF.error("Failed to read emoji cache",e),localStorage.removeItem(F),{data:[],isExpired:!0}}},B=async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(C)return new Promise(e=>{E.push(e)});if(k.length>0&&!e)return k;if(!e){let{data:e,isExpired:t}=N();if(e.length>0)return k=e,t?setTimeout(()=>{B(!0).catch(console.error)},0):q||R(e),k}try{C=!0;let e=[{interaction_type:"salute",display_name:"Salute",icon:b,lottie:g},{interaction_type:"rofl",display_name:"Rofl",icon:m,lottie:y},{interaction_type:"clap",display_name:"Clap",icon:s,lottie:c},{interaction_type:"heart-eyes",display_name:"Heart-Eyes",icon:p,lottie:u},{interaction_type:"flying-saucer",display_name:"Flying-Saucer",icon:d,lottie:l},{interaction_type:"money-with-wings",display_name:"Money-With-Wings",icon:f,lottie:h},{interaction_type:"100",display_name:"100",icon:r,lottie:o}];k=e;try{let t={data:e,expireTime:Date.now()+3e5};localStorage.setItem(F,btoa(JSON.stringify(t)))}catch(e){j.vF.error("Failed to save emoji cache",e)}return q||R(e),A(e),e}catch(e){return j.vF.error("Failed to fetch emojis",e),A(k),k}finally{C=!1}},U=(0,n.createContext)({emojis:[],isLoading:!1,getEmojiByType:()=>void 0,refreshEmojis:async()=>{},asyncGetEmojis:async()=>[],getLottieData:()=>null,interact:()=>Promise.resolve(""),registerInteractionCallback:()=>{}}),K=e=>{let{children:t}=e,[a,o]=(0,n.useState)([]),[r,c]=(0,n.useState)(!1),{userId:s}=(0,v.J)(),{checkAuth:l}=(0,w.M)(),d=(0,n.useRef)(new O),u=(0,_.A)(()=>s);(0,n.useEffect)(()=>{setTimeout(()=>{P()},3e3)},[]),(0,n.useEffect)(()=>{let e=!0;return(async()=>{c(!0);let t=await p();e&&(o(t),c(!1))})(),()=>{e=!1}},[]);let p=async()=>{if(k.length>0){let{isExpired:e}=N();return e&&!r&&setTimeout(()=>{B(!0).catch(console.error)},0),k}return B()},h=async(e,t,a)=>l(async()=>d.current.addOperation(e,t,a,u()||""),{title:"Love this project?",description:"Log in to leave reactions and show some love.",cancelText:"Cancel",confirmText:"Log in"})()||"",f=async()=>{await B(!0)};return(0,i.jsx)(U.Provider,{value:{emojis:a,isLoading:r,getEmojiByType:e=>a.find(t=>t.interaction_type===e),refreshEmojis:f,asyncGetEmojis:p,getLottieData:J,interact:h,registerInteractionCallback:(e,t)=>{d.current.registerCallback(e,t)}},children:t})},Q=()=>(0,n.useContext)(U)},54623:(e,t,a)=>{a.d(t,{M:()=>s});var i=a(48002),n=a(76126),o=a(10578),r=a(97913),c=a(46263);let s=()=>{let{isLoggedIn:e}=(0,n.J)(),t=(0,i.useRouter)(),a=(0,o.A)(()=>e);return{checkAuth:(e,i)=>async function(){for(var n=arguments.length,o=Array(n),s=0;s<n;s++)o[s]=arguments[s];return a()?e(...o):new Promise(e=>{(0,r.S)({title:i.title,description:i.description,cancelText:i.cancelText||"Cancel",confirmText:i.confirmText||"Log in",onCancel:()=>{i.onCancel&&i.onCancel(),e(void 0)},onConfirm:()=>{let a=(0,c.getOrigin)()+window.location.pathname+window.location.search;t.push("".concat((0,c.getOrigin)(),"/login?returnTo=").concat(encodeURIComponent(a))),e(void 0)}})})}}}},61924:(e,t,a)=>{a.d(t,{f:()=>i});var i=function(e){return e.Add="add",e.Cancel="cancel",e}({})}}]);